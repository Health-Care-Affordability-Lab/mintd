#!/bin/bash
# Data pull script for {{ full_project_name }}
#
# Pulls approved data products from registry sources.
# Run this on a networked machine with internet access.

set -e

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(dirname "$SCRIPT_DIR")"

# Change to project root directory
cd "$PROJECT_ROOT"

# Add current directory to Python path for module imports
export PYTHONPATH="$PROJECT_ROOT:$PYTHONPATH"

echo "üîÑ Pulling data for {{ full_project_name }}"
echo "Working directory: $PWD"
echo

# Check if Python is available
if ! command -v python3 &> /dev/null && ! command -v python &> /dev/null; then
    echo "‚ùå Python not found. Please install Python 3.9+."
    exit 1
fi

# Use python3 if available, otherwise python
PYTHON_CMD="python3"
if ! command -v python3 &> /dev/null; then
    PYTHON_CMD="python"
fi

# Check if required packages are installed
$PYTHON_CMD -c "import yaml, git, dvc" 2>/dev/null || {
    echo "‚ùå Required packages not installed. Please run:"
    echo "   pip install pyyaml gitpython dvc"
    exit 1
}

# Run the download script (located in src/ directory)
echo "Starting data download..."
if [ $# -eq 0 ]; then
    # No arguments - pull all
    $PYTHON_CMD -m src.download --all
elif [ "$1" = "--all" ]; then
    # Explicit --all flag
    $PYTHON_CMD -m src.download --all
else
    # Pull specific repo
    $PYTHON_CMD -m src.download "$@"
fi

echo
echo "‚úÖ Data pull complete."
echo "Run './scripts/package_transfer.sh' to create transfer package."
