#' Configuration for {{ project_name }}
#'
#' This file centralizes project configuration including paths and random seeds.
#' Modify this file to set your base path and other project-specific settings.
#'
#' Per AEA Data Editor guidelines for reproducible research:
#' https://aeadataeditor.github.io/aea-de-guidance/preparing-for-data-deposit

# =============================================================================
# BASE PATH CONFIGURATION
# =============================================================================
# Set this to your project root directory.
# All other paths are relative to this base path.

# Default: one directory up from this file (code/ -> project root)
BASE_PATH <- normalizePath(file.path(dirname(sys.frame(1)$ofile), ".."),
                           mustWork = FALSE)

# Fallback if sourced interactively
if (is.null(sys.frame(1)$ofile)) {
  # Assume we're in code/
  if (file.exists("../metadata.json")) {
    BASE_PATH <- normalizePath("..")
  } else {
    BASE_PATH <- getwd()
    warning("Could not determine project root. Using current directory.")
  }
}

# =============================================================================
# RANDOM SEED FOR REPRODUCIBILITY
# =============================================================================
# Set a fixed random seed for all stochastic operations.
# Document this in your README per AEA guidelines.

RANDOM_SEED <- 12345
set.seed(RANDOM_SEED)

# =============================================================================
# DERIVED PATHS (do not modify)
# =============================================================================
DATA_DIR <- file.path(BASE_PATH, "data")
RAW_DIR <- file.path(DATA_DIR, "raw")
ANALYSIS_DIR <- file.path(DATA_DIR, "analysis")

RESULTS_DIR <- file.path(BASE_PATH, "results")
FIGURES_DIR <- file.path(RESULTS_DIR, "figures")
TABLES_DIR <- file.path(RESULTS_DIR, "tables")
ESTIMATES_DIR <- file.path(RESULTS_DIR, "estimates")

CODE_DIR <- file.path(BASE_PATH, "code")

#' Get all project paths as a named list
#'
#' @return Named list with paths: base, data, raw, analysis, results, figures,
#'         tables, estimates, code
#' @export
get_paths <- function() {
  list(
    base = BASE_PATH,
    data = DATA_DIR,
    raw = RAW_DIR,
    analysis = ANALYSIS_DIR,
    results = RESULTS_DIR,
    figures = FIGURES_DIR,
    tables = TABLES_DIR,
    estimates = ESTIMATES_DIR,
    code = CODE_DIR
  )
}

#' Set random seed for reproducibility
#'
#' @param seed Integer random seed (default: RANDOM_SEED from config)
#' @export
setup_random_seed <- function(seed = RANDOM_SEED) {
  set.seed(seed)
  message(paste("Random seed set to:", seed))
}

# =============================================================================
# LOOKUP FUNCTIONS
# =============================================================================
# These functions act as lookup tables for case-specific configurations.
# Use them to centralize variable definitions, tags, and settings that
# vary across different analysis cases or specifications.

# Define case configurations as named lists
CASE_TAGS <- list(
  baseline = "base",
  robustness1 = "rob1",
  robustness2 = "rob2"
)

CASE_SPECS <- list(
  baseline = list(
    depvar = "outcome",
    controls = c("x1", "x2", "x3"),
    fe = c("year", "group")
  ),
  extended = list(
    depvar = "outcome",
    controls = c("x1", "x2", "x3", "x4", "x5"),
    fe = c("year", "group", "region")
  )
)

# Pretty names for display in tables/figures
PRETTY_NAMES <- list(
  # Variables
  outcome = "Outcome Variable",
  x1 = "Control 1",
  x2 = "Control 2",
  x3 = "Control 3",
  # Cases/specifications
  baseline = "Baseline",
  robustness1 = "Robustness Check 1",
  robustness2 = "Robustness Check 2",
  extended = "Extended Controls"
)

#' Lookup table for case-specific tags
#'
#' @param case The case name to look up
#' @return The tag associated with the case, or the case name if not found
#' @export
#' @examples
#' tag <- case2tag("baseline")
#' print(tag)  # "base"
case2tag <- function(case) {
  tag <- CASE_TAGS[[case]]
  if (is.null(tag)) {
    tag <- case  # Default: use case name as tag
  }
  message(sprintf("case2tag: looked up '%s' ; returned tag '%s'", case, tag))
  return(tag)
}

#' Lookup table for case-specific variable lists
#'
#' @param case The case name to look up
#' @return Named list with: depvar, controls, fe
#' @export
#' @examples
#' spec <- case2vars("baseline")
#' print(spec$depvar)    # "outcome"
#' print(spec$controls)  # c("x1", "x2", "x3")
case2vars <- function(case) {
  spec <- CASE_SPECS[[case]]
  if (is.null(spec)) {
    stop(sprintf("case2vars: unknown case '%s'", case))
  }
  message(sprintf("case2vars: looked up '%s'", case))
  return(spec)
}

#' Get a display-friendly label for a variable or case name
#'
#' Useful for creating publication-quality tables and figures.
#'
#' @param name The variable or case name to look up
#' @return The pretty name if found, otherwise title-cased version of input
#' @export
#' @examples
#' pretty_name("outcome")      # "Outcome Variable"
#' pretty_name("x1")           # "Control 1"
#' pretty_name("unknown_var")  # "Unknown Var"
pretty_name <- function(name) {
  pretty <- PRETTY_NAMES[[name]]
  if (!is.null(pretty)) {
    return(pretty)
  }
  # Default: convert underscores to spaces and title case
  return(tools::toTitleCase(gsub("_", " ", name)))
}

# Print configuration on source
message("Configuration loaded from: ", BASE_PATH)
message("Random seed: ", RANDOM_SEED)
