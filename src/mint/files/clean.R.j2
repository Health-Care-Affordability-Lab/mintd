#' Data cleaning for {{ project_name }}
#'
#' This script handles data cleaning and preprocessing.

# Import mint utilities
source("_mint_utils.R")

# Set up directories
set_directories <- function() {
  dirs <- list(
    raw = file.path("data", "raw"),
    intermediate = file.path("data", "intermediate"),
    final = file.path("data", "final")
  )

  lapply(dirs, function(d) {
    if (!dir.exists(d)) dir.create(d, recursive = TRUE)
  })

  return(dirs)
}

main <- function() {
  # Initialize logging (filename will include any parameters passed)
  logger <- ParameterAwareLogger("clean")
  logger$log("Starting data cleaning for {{ project_name }}...")

  dirs <- set_directories()

  logger$log("Directories ready:")
  logger$log("  Raw data: ", dirs$raw)
  logger$log("  Intermediate: ", dirs$intermediate)
  logger$log("  Final data: ", dirs$final)

  # TODO: Implement data cleaning logic
  # - Load raw data from data/raw/
  # - Handle missing values, data types, outliers
  # - Standardize formats and encodings
  # - Save cleaned data to data/intermediate/

  # Example:
  # library(dplyr)
  # library(readr)
  #
  # # Load raw data
  # raw_files <- list.files(dirs$raw, pattern = "*.csv", full.names = TRUE)
  # for (raw_file in raw_files) {
  #   df <- read_csv(raw_file)
  #
  #   # Basic cleaning
  #   df <- df %>% drop_na()  # Remove missing values
  #   names(df) <- tolower(gsub(" ", "_", names(df)))
  #
  #   # Save cleaned data
  #   intermediate_file <- file.path(dirs$intermediate, paste0("clean_", basename(raw_file)))
  #   write_csv(df, intermediate_file)
  #   logger$log("Cleaned ", nrow(df), " rows, saved to ", intermediate_file)
  # }

  logger$log("Data cleaning completed successfully.")
  logger$close()
}

if (!interactive()) {
  main()
}