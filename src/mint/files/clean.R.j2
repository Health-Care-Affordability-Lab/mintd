#' Data cleaning for {{ project_name }}
#'
#' This script handles data cleaning and preprocessing.
#' NOTE: This script runs from the src/ directory. Data paths use ../data/

# Import mint utilities (located in same src/ directory)
source("_mint_utils.R")

main <- function() {
  # Initialize logging (validates directory and creates log file)
  logger <- ParameterAwareLogger("clean")
  logger$log("Starting data cleaning for {{ project_name }}...")

  # Ensure data directories exist (using global paths from _mint_utils.R)
  paths <- get_data_paths()
  lapply(paths, function(d) {
    if (!dir.exists(d)) dir.create(d, recursive = TRUE)
  })

  logger$log("Directories ready:")
  logger$log("  Raw data: ", RAW_DIR)
  logger$log("  Intermediate: ", INTERMEDIATE_DIR)
  logger$log("  Final data: ", FINAL_DIR)

  # TODO: Implement data cleaning logic
  # - Load raw data from RAW_DIR/
  # - Handle missing values, data types, outliers
  # - Standardize formats and encodings
  # - Save cleaned data to INTERMEDIATE_DIR/

  # Example:
  # library(dplyr)
  # library(readr)
  #
  # # Load raw data
  # raw_files <- list.files(RAW_DIR, pattern = "*.csv", full.names = TRUE)
  # for (raw_file in raw_files) {
  #   df <- read_csv(raw_file)
  #
  #   # Basic cleaning
  #   df <- df %>% drop_na()  # Remove missing values
  #   names(df) <- tolower(gsub(" ", "_", names(df)))
  #
  #   # Save cleaned data
  #   final_file <- file.path(FINAL_DIR, paste0("clean_", basename(raw_file)))
  #   write_csv(df, final_file)
  #   logger$log("Cleaned ", nrow(df), " rows, saved to ", final_file)
  # }

  logger$log("Data cleaning completed successfully.")
  logger$close()
}

if (!interactive()) {
  main()
}